# 정리

- 스케일 업 : 수직적 확장
    - cpu, 메모리 등 자원을 늘리기
- 스케일 아웃 : 수평적 확장
    - 서버를 늘리기

1. 로드벨런서와 하위 서버들 간의 통신을 할 때는 어떤 네트워크를 탈까?
- 사설 IP 주소를 사용해서 통신함
    - 즉 로드벨런서와 하위 서버들 간의 통신을 할 때는 NAT로 통신하는 거 같음

2. 데이터베이스 다중화
- 주(master) DB = 쓰기(insert, delete, update) + 읽기 연산
- 부(slave) DB = 읽기 연산

<img width="757" alt="image" src="https://github.com/user-attachments/assets/75168dd2-777d-4d64-83b6-e125ffca7d22">


- 궁금한 점
    - 새로운 내용이  주 DB에 써지면 언제 어떻게 부 DB로 전송이 돼서 가용성이 유지되는 걸까?
        - batch를 쓰는거면 실시간이 아닌거고, 실시간으로 insert를 모든 부 DB에 처리해줘야하는 거면 비효율적인거 같다는 생각이 든다 → 궁금함!

3. 캐시
- 지금까지 프로젝트 우선읽기전략으로 캐시 전략 썼음(read through caching strategy) + LRU

4. 콘텐츠 전송 네트워크(CDN)
- nginx를 사용해서 CDN 구축함

5. 무상태 웹 계층
- 인증 인가를 위한 처리에 관한 데이터를 nosql에 넣어놓고 다른 서버에서도 이를 활용한다는 의미 같음
    - 상태가 필요할 때 nosql을 다녀온다

6. 데이터 센터
- 처음 이 내용을 봤을 때 이걸 왜 해야하나 이해가 안됐음
    - 전제가 전세계 사람들이 사용하는 서비스를 구축하는 것임
    - 그렇기 때문에 지리적 라우팅을 사용해서 응답속도를 빠르게 해주려고 하는거임
- 넷플릭스가 여러 데이터센터에 걸쳐 데이터를 어떻게 다중화 했는지 궁금함 누군가 이 주제로 심화 했으면 좋겠다.. ㅎ

7. 메시지 큐
- 카프카를 말하는 거 같음


8. 데이터 베이스 규모 확장

- 수직적 확장
    - 스펙 늘리기
- 수평적 확장
    - 샤딩

- 샤딩
    - 서버 증설
    - 샤딩은 대규모 데이터베이스를 샤드 라고 부르는 작은 단위로 분할하는 기술을 일컫는다.
        - 모든 샤드는 같은 스키마를 사용하지만, 샤드에 보관되는 데이터 사이에 중복이 없다.
            - 샤드는 각각의 DB를 의미함
            - 여러 DB가 모여서 하나의 큰 데이터베이스가 되는 기술이 샤딩
            - 그래서 각 DB는 중복되는 데이터가 없다는 의미
    - 샤딩 전략을 구현할 때 고려해야할 가장 중요한 것은 샤딩 키를 어떻게 정하느냐 이다.

- 샤딩 키(파티션 키)
    - 샤딩 키를 통해 올바른 데이터베이스에 질의를 보내 데이터 조회나 변경을 처리하므로 효율을 높일 수 있다.
    - 따라서 데이터를 고르게 분할 할 수 있는 샤딩키를 사용하는게 중요

- 샤딩을 적용했을 때 해결해야하는 문제들
    - 데이터의 재 샤딩
        - 재 샤딩은 데이터가 너무 많아져서 하나의 샤드로는 더 이상 감당하기 어려울 때 필요함
        - 샤드 간 데이터 분포가 균등하지 않아 어떤 샤드(DB)에 할당된 공간 소보가 다른 샤드에 비해 빠르게 진행될 때(샤드 소진) → 이 때는 샤드 키를 계산하는 함수를 변경하고 데이터를 재배치해야함 == 해싱을 통해 해결
    - 유명인사 문제 == 핫스팟 키
        - 특정 샤드(DB)에 질의가 집중되어 과부하걸리는 문제를 의미
            - 유명인사를 각 샤드에 나눠 배치하거나 잘게 쪼개야함
    - 조인과 비정규화
        - 하나의 데이터베이스를 여러 샤드로 쪼개고 나면 여러 샤드에 걸친 데이러틑 조인하기 힘들어짐
        - 이를 해결하는 방법은 데이터베이스를 비정규화하여 하나의 테이블에서 질의가 수행될 수 있도록 해야함

### 1장 총 정리

- 시스템 규모 확장을 위해 살펴 본 기법들
    - 웹 계층은 무상태 계층으로
    - 모든 계층에 다중화 도입
    - 가능한 많은 데이터를 캐싱할 것
    - 여러 데이터 센터를 지원할 것
    - 정적 콘텐츠는 CDN을 통해 서비스할 것
    - 데이터 계층은 샤딩을 통해 그 규모를 확장할 것
    - 각 계층은 독립적 서비스로 분할할 것
    - 시스템을 지속적으로 모니터링하고, 자동화 도구를 활용할 것
